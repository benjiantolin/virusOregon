<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="authors" content="Benji Antolin inspired by UW Humanistic GIS Lab COVID-19 Webmap">
  <title>Oregon COVID-19 Map</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <link rel="stylesheet" href="css/MarkerCluster.Default.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Oswald&display=swap" rel="stylesheet">
  <link href="css/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/simplebar.css" />
  <link rel="stylesheet" href="css/main.css">
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <script src="js/d3.js"></script>
  <script src="js/c3.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="js/leaflet.markercluster.js"></script>
  <script src="js/topojson.v1.min.js"></script>
  <script src="js/chroma.min.js"></script>
  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="js/simplebar.min.js"></script>
</head>

<body>
  <main>
    <div class="loader"></div>
    <div id="info" data-simplebar data-simplebar-auto-hide="true">
      <div id="title" style="font-size:23px"><i class="fas fa-bug"></i> Oregon COVID-19 Map
        <span><a href="" target="_blank"><i class="fab fa-twitter-square"></i></a></span>
        <span><a href="https://github.com/benjiantolin/virusOregon" target="_blank"><i class="fab fa-github-square"></i></a></span>
        <span><a data-toggle="modal" data-target="#resourcewindow"><i class="far fa-newspaper"></i></a></span>
        <span><a data-toggle="modal" data-target="#infowindow"><i class="nav fas fa-question-circle"></i></a></span>
      </div>

      <p><span id="placename">Oregon State Trend</span> </p>
      <div> <span id="date"></span> <span id="hint"> Click on map to review county statistics.</span></div>
      <div id="deck-1" class="card-deck counts">
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">Cases</h5>
          </div>
          <p class="card-text"><span class="confirmed-count"></span><span class="confirmed-new-count"></span></p>
        </div>

        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">Deaths</h5>
          </div>
          <p class="card-text"><span class="active-count"></span><span class="active-new-count"></span></p>
        </div>
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">Neg. Test Results</h5>
          </div>
          <p class="card-text"><span class="neg-count"></span><span class="neg-new-count"></span></p>
        </div>
      </div>


      <div id="total-chart"></div>
      <div id="age-chart"></div>
      <div id="hosp-chart"></div>

      <div id="footer">
        If you have any questions or concerns, please contact <a href="mailto:benjamin.antolin@oregonstate.edu">Benji Antolin</a>.
      </div>


    </div>


    </div>

    <div id="map"></div>

    <div id="legend-panel">

      <div class="card-deck legend">

        <div class="card">
          <div class="card-body legend-color-1">
            <h5 class="card-title" style="color:black">No Data</h5>

          </div>
        </div>

        <div class="card">
          <div class="card-body  legend-color-2">
            <h5 class="card-title" style="color:black">1</h5>

          </div>
        </div>
        <div class="card">
          <div class="card-body  legend-color-3">
            <h5 class="card-title" style="color:black">2-6</h5>

          </div>
        </div>

        <div class="card">
          <div class="card-body  legend-color-4">
            <h5 class="card-title" style="color:black">7-12</h5>

          </div>
        </div>

        <div class="card">
          <div class="card-body legend-color-5">
            <h5 class="card-title" style="color:black">13-22</h5>
          </div>
        </div>
        <div class="card">
          <div class="card-body legend-color-6">
            <h5 class="card-title" style="color:black">23+</h5>
          </div>
        </div>
      </div>

    </div>
  </main>
  <div id="infowindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">Info</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <p>This online interactive map enables users to track both the Oregon State and County trends of Novel Coronavirus infection since Jan 21st, 2020. The supporting dataset is timely collected from <a
                href="https://govstatus.egov.com/OR-OHA-COVID-19" target="_blank">The Oregon Health Authority</a> and then plotted onto
              this web application.</p>
            <h5>Data Sources</h5>
            <p>The data are mainly collected from 1. <a href="http://www.nhc.gov.cn" target="_blank">National Health Commission</a> (NHC) of the People’s Republic of China
              2. China’s Provincial & Municipal Health Commission, China’s Provincial & Municipal government database
              3. Public data published from Hongkong, Macau, and Taiwan official channels
              4. <a href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/situation-reports/" target="_blank">World Health Organization</a> (WHO)
              5. <a href="https://www.cdc.gov/coronavirus/2019-ncov/cases-in-us.html" target="_blank">Centers for Disease Control and Prevention</a> (CDC)
              6. <a href="https://www.canada.ca/en/public-health/services/diseases/2019-novel-coronavirus-infection.html" target="_blank">Public Health Agency of Canada</a> (PHAC)
              7. <a href="https://voice.baidu.com/act/newpneumonia/newpneumonia" target="_blank">Baidu</a>.
              8. <a href="https://mapmiao.com/ncov/" target="_blank">Mapmiao</a>(data of quarantine area in China).
              The dataset (in SQLite format) can be downloaded from <a href="http://hgis.uw.edu/virus/assets/virus.db" target="_blank">here</a>.
              You can view the data (in CSV format) at <a href="http://hgis.uw.edu/virus/assets/virus.csv" target="_blank">here</a>.</p>

            <p>In the data table, each entry indicates the infection status in the format of "#-#-#-#" -- a 4-sequel entry divided by dashes. The first sequel represents the number of confirmed cases, the second sequel represents suspected
              cases, the third sequel represents cured cases, the fourth sequel represents death cases.</p>

            <h5>Update Procedure</h5>

            <p>The country-level data is collected from WHO, while the data of each province in China is collected from multiple sources such as China's NHC，Mapmiao and Baidu. Notably, we also refer to CDC to verify the virus spreading status in the
              U.S. To
              make a timely data and map updates, we collect the data every 4 hours, and verify the data quality per day. In addition, we plan to provide finer-scale data from China (the county level), U.S. (the state level) and Canada (the province
              level) in the next version.</p>

            <h5>Acknowledgment</h5>
            <p>
              <li>Created by: Benji Antolin insipired by UW HGIS Lab COVID 19 Map</li>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="resourcewindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">Resource</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <h5>Coronavirus information resources</h5>
            <br><b> China - Official Websites</b>
            <table style="width:100%">
              <tr>
                <td><a href="http://wjw.beijing.gov.cn/xwzx_20031/wnxw/" target="_blank"> Beijing</a></td>
                <td><a href="http://wsjkw.hebei.gov.cn/list/more_newlist_14.html" target="_blank"> Hebei</a></td>
                <td><a href="http://wsjk.ln.gov.cn/wst_zdzt/xxgzbd/yqtb/" target="_blank"> Liaoning</a></td>
                <td><a href=" http://www.jl.gov.cn/szfzt/jlzxd/yqtb/" target="_blank"> Jilin</a></td>
              </tr>
              <tr>
                <td><a href="http://wjw.jiangsu.gov.cn/col/col7290/index.html" target="_blank"> Jiangsu</a></td>
                <td><a href="http://wsjkw.sh.gov.cn/yqfk2020/" target="_blank"> Shanghai</a></td>
                <td><a href="http://hc.jiangxi.gov.cn/ztxx/xxgzbdgrdfyyqfk/yqtb/index.shtml" target="_blank"> Jiangxi</a></td>
                <td><a href="http://wsjkw.gd.gov.cn/zwyw_yqxx/" target="_blank"> Guangdong</a></td>
              </tr>
              <tr>
                <td><a href="http://wjw.hunan.gov.cn/wjw/qwfb/yqfkgz_list.html" target="_blank"> Hunan</a></td>
                <td><a href="http://wst.hainan.gov.cn/yqfk/" target="_blank"> Hainan</a></td>
                <td><a href="https://www.zjwjw.gov.cn/col/col1202112/index.html" target="_blank"> Zhejiang</a></td>
                <td><a href="http://www.hnwsjsw.gov.cn/channels/854.shtml" target="_blank"> Henan</a></td>
              </tr>
              <tr>
                <td><a href="http://hc.jiangxi.gov.cn/ztxx/xxgzbdgrdfyyqfk/yqtb/index.shtml" target="_blank"> Jiangxi</a></td>
                <td><a href="http://wjw.hubei.gov.cn/bmdt/ztzl/fkxxgzbdgrfyyq/xxfb/" target="_blank"> Hubei</a></td>
                <td><a href=" http://sxwjw.shaanxi.gov.cn/col/col9/index.html" target="_blank"> Shaanxi</a></td>
                <td><a href="http://wjw.shanxi.gov.cn/wjywl02/index.hrh" target="_blank"> Shanxi</a></td>
              </tr>
              <tr>
                <td><a href="http://wsjkw.nx.gov.cn/yqfkdt/yqsd1.htm" target="_blank"> Ningxia</a></td>
                <td><a href="https://wsjkw.qinghai.gov.cn/ztbd/yqjk/fkdt/2020/02/18/1582009147575.html" target="_blank"> Qinghai</a></td>
                <td><a href="http://wsjk.gansu.gov.cn/channel/11217/index.html" target="_blank"> Gansu</a></td>
                <td><a href="http://xjhfpc.gov.cn/ztzl/fkxxgzbdfygz/yqtb.htm" target="_blank"> Xinjiang</a></td>
              </tr>
              <tr>
                <td><a href="http://www.gzhfpc.gov.cn/ztzl_500663/xxgzbdgrdfyyqfk/" target="_blank"> Guizhou</a></td>
                <td><a href="http://ynswsjkw.yn.gov.cn/wjwWebsite/web/col?id=UU157976428326282067&cn=xxgzbd&pcn=ztlm&pid=UU145102906505319731" target="_blank"> Yunnan</a></td>
                <td><a href="http://wsjkw.cq.gov.cn/topic/25.jspx" target="_blank"> Chongqing</a></td>
                <td><a href="http://wjw.xizang.gov.cn/xwzx/wsjkdt/" target="_blank"> Xizang</a></td>
              </tr>
              <tr>
                <td><a href="https://www.ssm.gov.mo/apps1/PreventWuhanInfection/ch.aspx#clg17046" target="_blank"> Macau</a></td>
                <td><a href="https://sites.google.com/cdc.gov.tw/2019ncov/taiwan" target="_blank"> Taiwan</a></td>
                <td><a href="http://wsjkw.hlj.gov.cn/index.php/Home/Zwgk/all/typeid/42" target="_blank"> Heilongjiang</a></td>
                <td><a href="https://v.gxnews.com.cn/zt/2020yq" target="_blank"> Guangxi</a></td>
              </tr>
              <tr>
                <td><a href="http://wjw.ah.gov.cn/news_list_477_1.html" target="_blank"> Anhui</a></td>
                <td><a href="http://wjw.nmg.gov.cn/xwzx/xwfb/index.shtml" target="_blank"> Neimenggu</a></td>
                <td><a href="http://wsjkw.sc.gov.cn/scwsjkw/gzbd01/ztwzlmgl.shtml" target="_blank"> Sichuan</a></td>
                <td><a href="https://www.chp.gov.hk/files/pdf/enhanced_sur_pneumonia_wuhan_chi.pdf" target="_blank"> Hongkong</a></td>
              </tr>
            </table>
            <br><b> the US - Official Websites</b>
            <table style="width:100%">
              <tr>
                <td><a href="http://www.alabamapublichealth.gov/infectiousdiseases/2019-coronavirus.html" target="_blank">Alabama</a></td>
                <td><a href="https://dphhs.mt.gov/publichealth/cdepi/diseases/coronavirusmt" target="_blank">Montana</a></td>
                <td><a href="http://dhss.alaska.gov/dph/Epi/id/Pages/COVID-19/monitoring.aspx" target="_blank">Alaska</a></td>
                <td><a href="http://dhhs.ne.gov/Pages/Coronavirus.aspx" target="_blank">Nebraska</a></td>
              </tr>
              <tr>
                <td><a href="https://www.azdhs.gov/preparedness/epidemiology-disease-control/infectious-disease-epidemiology/index.php#novel-coronavirus-home" target="_blank">Arizona</a></td>
                <td><a href="http://dpbh.nv.gov/Programs/OPHIE/dta/Hot_Topics/Coronavirus/" target="_blank">Nevada</a></td>
                <td><a href="https://www.healthy.arkansas.gov/programs-services/topics/novel-coronavirus" target="_blank">Arkansas</a></td>
                <td><a href="https://www.dhhs.nh.gov/dphs/cdcs/2019-ncov.htm" target="_blank">New Hampshire</a></td>
              </tr>
              <tr>
                <td><a href="https://www.cdph.ca.gov/Programs/CID/DCDC/Pages/Immunization/ncov2019.aspx" target="_blank">California</a></td>
                <td><a href=" https://www.colorado.gov/pacific/cdphe/2019-novel-coronavirus" target="_blank">Colorado</a></td>
                <td><a href="https://cv.nmhealth.org/" target="_blank">New Mexico</a></td>
                <td><a href=" https://portal.ct.gov/coronavirus" target="_blank">Connecticut</a></td>
              </tr>
              <tr>
                <td><a href=" https://health.ny.gov/diseases/communicable/coronavirus/" target="_blank">New York</a></td>
                <td><a href="https://www.dhss.delaware.gov/dhss/dph/epi/2019novelcoronavirus.html" target="_blank">Delaware</a></td>
                <td><a href="https://coronavirus.dc.gov/page/coronavirus-surveillance-data" target="_blank">The District of Columbia</a></td>
                <td><a href="https://www.health.nd.gov/diseases-conditions/coronavirus/north-dakota-coronavirus-cases" target="_blank">North Dakota</a></td>
              </tr>
              <tr>
                <td><a href="http://www.floridahealth.gov/diseases-and-conditions/COVID-19/index.html" target="_blank">Florida</a></td>
                <td><a href="https://coronavirus.ohio.gov/wps/portal/gov/covid-19/" target="_blank">Ohio</a></td>
                <td><a href="https://dph.georgia.gov/" target="_blank">Georgia</a></td>
                <td><a href="https://www.ok.gov/health/Prevention_and_Preparedness/Acute_Disease_Service/Disease_Information/Coronavirus_Disease_2019/Oklahoma_Response_to_Coronavirus_Disease_2019/index.html" target="_blank">Oklahoma</a></td>
              </tr>
              <tr>
                <td><a href="https://www.oregon.gov/oha/PH/DISEASESCONDITIONS/DISEASESAZ/Pages/emerging-respiratory-infections.aspx" target="_blank">Oregon</a></td>
                <td><a href="https://health.hawaii.gov/docd/advisories/novel-coronavirus-2019/#situation" target="_blank">Hawaii</a></td>
                <td><a href="https://coronavirus.idaho.gov/" target="_blank">Idaho</a></td>
                <td><a href="https://www.health.pa.gov/topics/disease/Pages/Coronavirus.aspx" target="_blank">Pennsylvania</a></td>
              </tr>
              <tr>
                <td><a href="http://dph.illinois.gov/topics-services/diseases-and-conditions/diseases-a-z-list/coronavirus" target="_blank">Illinois</a></td>
                <td><a href="https://www.scdhec.gov/index.php/health/infectious-diseases/viruses/coronavirus-disease-2019-covid-19" target="_blank">South Carolina</a></td>
                <td><a href="https://idph.iowa.gov/Emerging-Health-Issues/Novel-Coronavirus" target="_blank">Iowa</a></td>
                <td><a href="https://doh.sd.gov/news/Coronavirus.aspx" target="_blank">South Dakota</a></td>
              </tr>
              <tr>
                <td><a href="https://chfs.ky.gov/agencies/dph/pages/covid19.aspx" target="_blank">Kentucky</a></td>
                <td><a href="https://www.dshs.state.tx.us/coronavirus/#casecounts" target="_blank">Texas</a></td>
                <td><a href="https://coronavirus.utah.gov/coronavirus-latest-information/" target="_blank">Utah</a></td>
                <td><a href="https://www.maine.gov/dhhs/mecdc/infectious-disease/epi/airborne/coronavirus.shtml" target="_blank">Maine</a></td>
              </tr>
              <tr>
                <td><a href="https://www.healthvermont.gov/response/infectious-disease/2019-novel-coronavirus" target="_blank">Vermont</a></td>
                <td><a href="https://phpa.health.maryland.gov/Pages/Novel-coronavirus.aspx" target="_blank">Maryland</a></td>
                <td><a href="http://www.vdh.virginia.gov/surveillance-and-investigation/novel-coronavirus/" target="_blank">Virginia</a></td>
                <td><a href="https://www.mass.gov/info-details/covid-19-cases-quarantine-and-monitoring" target="_blank">Massachusetts</a></td>
              </tr>
              <tr>
                <td><a href="https://www.doh.wa.gov/Emergencies/Coronavirus" target="_blank">Washington</a></td>
                <td><a href="https://www.michigan.gov/coronavirus" target="_blank">Michigan</a></td>
                <td><a href=" https://dhhr.wv.gov/Coronavirus%20Disease-COVID-19/Pages/default.aspx" target="_blank">West Virginia</a></td>
                <td><a href="https://www.health.state.mn.us/diseases/coronavirus/situation.html" target="_blank">Minnesota</a></td>
              </tr>
              <tr>
                <td><a href="https://www.dhs.wisconsin.gov/outbreaks/index.htm" target="_blank">Wisconsin</a></td>
                <td><a href=" https://msdh.ms.gov/msdhsite/_static/14,0,420.html" target="_blank">Mississippi</a></td>
                <td><a href="https://health.wyo.gov/publichealth/infectious-disease-epidemiology-unit/disease/novel-coronavirus/" target="_blank">Wyoming</a></td>
                <td><a href="https://health.mo.gov/living/healthcondiseases/communicable/novel-coronavirus/" target="_blank">Missouri</a></td>
              </tr>
            </table>
            <br><b>Other Countries - Official Websites</b>
            <table style="width:100%">
              <tr>
                <td><a href="https://www.cdc.gov/coronavirus/2019-ncov/cases-in-us.html" target="_blank"> the U.S.</a></td>
                <td><a href=" https://www.canada.ca/en/public-health/services/diseases/2019-novel-coronavirus-infection.html" target="_blank"> Canada</a></td>
                <td><a href="https://www.cdc.go.kr/board/board.es?mid=a20501000000&bid=0015" target="_blank"> Republic of Korean</a></td>
              </tr>
              <tr>
                <td><a href="https://www.mhlw.go.jp/stf/newpage_09571.html" target="_blank"> Japan</a></td>
                <td><a href="https://www.health.gov.au/news/health-alerts/novel-coronavirus-2019-ncov-health-alert#current-status" target="_blank"> Australia</a></td>
                <td><a href="https://www.moh.gov.sg/covid-19" target="_blank"> Singapore</a></td>
              </tr>
              <tr>
                <td><a href="http://www.salute.gov.it/nuovocoronavirus" target="_blank"> Italy</a></td>
                <td><a href="https://www.gov.uk/guidance/coronavirus-covid-19-information-for-the-public" target="_blank"> the UK</a></td>
                <td><a href="http://irangov.ir/cat/509" target="_blank"> Iran</a></td>
              </tr>
            </table>
            <br><b>Other Resources:</b>
            <ul>
              <li><a href="https://ncov.dxy.cn/" target="_blank"> Dingxiangyuan</a></li> (Update national daily data and educate Coronavirus knowledge)
              <li><a href="http://zhongxinzhiyuan.cn/yiqing_real_time_map.html" target="_blank"> Zhongxinzhiyuan</a></li> (Update the latest news and data visualization)
              <li><a href="http://2019ncov.nosugartech.com/search.html" target="_blank"> Tongchengchaxun</a></li> (Coronavirus confirmed patients' trips query tool)
              <li><a href="https://voice.baidu.com/act/newpneumonia/newpneumonia" target="_blank"> Baidu Coronavirus Data Report</a></li> (Update Global daily data and hot topics about Coronavirus)
              <li><a href="https://www.nejm.org/coronavirus" target="_blank"> The New England Journal of Medicine</a></li> (A collection of articles and other resources on the Coronavirus (Covid-19) outbreak, including clinical reports, management
              guidelines, and commentary)
              <li><a href="http://www.nhc.gov.cn/xcs/pfzs/list_gzbd.shtml" target="_blank"> National Health Commission of the People's Republic of China </a></li> (Coronavirus(Covid-19) legal knowledge)
            </ul>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    $(window).ready(function() {
      $('.loader').fadeOut("slow");
    });



    // L.TopoJSON = L.GeoJSON.extend({
    //   addData: function(jsonData) {
    //     if (jsonData.type === 'Topology') {
    //       for (key in jsonData.objects) {
    //         geojson = topojson.feature(jsonData, jsonData.objects[key]);
    //         L.GeoJSON.prototype.addData.call(this, geojson);
    //       }
    //     } else {
    //       L.GeoJSON.prototype.addData.call(this, jsonData);
    //     }
    //   }
    // });
    // Copyright (c) 2013 Ryan Clark
      $("#date").text("Last update: 3/22/2020");


    // var createLabelIcon = function(labelClass, labelText) {
    //   return L.divIcon({
    //     className: labelClass,
    //     html: labelText
    //   })
    // }
    //
    // var usBounds = L.latLngBounds(
    //   L.latLng(24.520833, -124.7771694), //Southwest
    //   L.latLng(49.384472, -66.947028) //Northeast
    // );



    var mymap = L.map('map', {
      center: [44, -122.5],
      zoomControl: false,
      zoom: 7,
      maxZoom: 10,
      minZoom: 3,
      worldCopyJump: true
    });
    // .fitWorld()
    new L.Control.Zoom({
      position: 'topright'
    }).addTo(mymap);





    var gray = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}@2x.png');
    // var dark = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png').addTo(mymap);
    var voyager =
      L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}@2x.png').addTo(mymap);
    var satellite =
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

    var baseLayers = {
      'CartoDB Light': gray,
      // 'Dark': dark,
      'CartoDB Voyager': voyager,
      'ESRI Satellite': satellite
    }



    var chart, rchart;

    var colors = chroma.scale('YlOrRd').mode('lch').colors(6);
    for (i = 0; i < 6; i++) {
      $('head').append($("<style> .region-color-" + (i + 1).toString() + " { color: " + colors[i] + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
      $('head').append($("<style> .legend-color-" + (i + 1).toString() + " { background: " + colors[i] + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
    }


    // var communities = new L.MarkerClusterGroup({
    //   spiderfyOnMaxZoom: false,
    //   singleMarkerMode: true,
    //   // showCoverageOnHover: false,
    //   // zoomToBoundsOnClick: false,
    //   iconCreateFunction: function(cluster) {
    //     return L.divIcon({
    //       html: '<i class="fas fa-procedures community community-marker"> <b>' + cluster.getChildCount() + '</b></i>'
    //     });
    //   }
    //
    // });
    //
    //
    // var cases = new L.MarkerClusterGroup({
    //   spiderfyOnMaxZoom: true,
    //   singleMarkerMode: true,
    //   // showCoverageOnHover: false,
    //   // zoomToBoundsOnClick: false,
    //   iconCreateFunction: function(cluster) {
    //     return L.divIcon({
    //       html: '<i class="fas fa-users community community-marker"> <b>' + cluster.getChildCount() + '</b></i>'
    //     });
    //   }
    //
    // }).addTo(mymap);



    Promise.all([
      d3.csv('assets/timeseries/virusOregon.csv'),
      d3.json("assets/virusOregonMin.geojson"),
      d3.csv('assets/timeseries/ORTests.csv'),
      d3.csv('assets/current/hospitalized.csv'),
      d3.csv('assets/current/ORAgePie.csv'),
      d3.json("assets/virusWashingtonMin.geojson")
    ]).then(function(datasets) {


      // datasets[2].forEach(function(d) {
      //   L.marker([parseFloat(d.lat), parseFloat(d.lng)]).bindPopup(d.name + "&nbsp;&nbsp;(<a target='_blank' href='https://translate.google.com/#view=home&op=translate&sl=zh-CN&tl=en&text=" + d.name + "'>Translate to English</a>)").addTo(
      //     communities);
      // })
      //
      //
      // datasets[4].forEach(function(d) {
      //   //console.log(d.id)
      //   L.marker([parseFloat(d.lat), parseFloat(d.lng)]).bindPopup("<b>" + d.no + "</b> <p>" + d.note + " identified on " + d.date + ", &nbsp;" + d.reference + ".</p>").addTo(
      //     cases);
      // })




      // //totalCases
      // function tc(county) {
      //   if (county == undefined) {
      //     county = 0
      //   } else {
      //     county = +county.split("-")[0];
      //   }
      //   return county;
      // }
      //
      //
      // //totalDeath
      // function td(county) {
      //   if (county.split("-")[1] == undefined) {
      //     county = 0
      //   } else {
      //     county = +county.split("-")[1];
      //   }
      //   return county;
      // }
      //

      var t = ["t"];
      var cases = ["Cases"];
      var deaths = ["Deaths"]
      var negTests = ["Negative Tests"]

      var oregon = {
        name: "Oregon",
        c: cases,
        d: deaths,
        neg: negTests,
      }

      function countyCounts(i) {
        tc = 0, td = 0, nt = 0;
        datasets[0].forEach(function(d) {
          var USTd = new Date(d["Date"])
          t.push(USTd.setHours(USTd.getHours() + 8));
          tc = 0, td = 0, nt = 0;
          current = d;
          delete current["Date"];
          if (i["name"] != "Oregon") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 3:
                nt += +items[2];
              case 2:
                td += +items[1];
              case 1:
                tc += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 3:
                  nt += +items[2];
                case 2:
                  td += +items[1];
                case 1:
                  tc += +items[0];
                  break;
              };

            });
            //
          }
          i["c"].push(tc);
          // i["s"].push(sp);
          i["d"].push(td);
          // i["neg"].push(nt);
        });

        $(".confirmed-count").text(tc);
        $(".neg-count").text(nt);
        // $(".confirmed-new-count").text("+"+cc);
        // $(".active-new-count").text(cd);
        $(".active-count").text(td);

        nc = i.c[i.c.length - 1] - i.c[i.c.length - 2];
        nr = i.d[i.d.length - 1] - i.d[i.d.length - 2];
        // nt = i.neg[i.neg.length - 1] - i.neg[i.neg.length - 2];

        if (nc > 0) {
          $(".confirmed-new-count").text("+" + nc.toString());
        } else if (nc == 0) {
          $(".confirmed-new-count").text("");
        } else {

          $(".confirmed-new-count").text(nc.toString());
        }

        if (nr > 0) {
          $(".recovered-new-count").text("+" + nr.toString());
        } else if (nr == 0) {
          $(".recovered-new-count").text("")
        } else {
          $(".recovered-new-count").text(nr.toString());
        }

        // if (nt > 0) {
        //   $(".recovered-new-count").text("+" + nt.toString());
        // } else if (nt == 0) {
        //   $(".recovered-new-count").text("")
        // } else {
        //   $(".recovered-new-count").text(nt.toString());
        // }
        //
        //
        if (i["name"] == "Oregon") {
          $("#placename").text(i["name"] + " State");
        } else {

          $("#placename").text(i["name"] + " County");

        }


      }

      function setColor(cases) {

        if (cases >= 23) {
          id = 5;
        } else if (cases > 12 && cases <= 22) {
          id = 3;
        } else if (cases > 6 && cases <= 12) {
          id = 2;
        } else if (cases > 1 && cases <= 6) {
          id = 1;
        } else if (cases > 0 && cases <= 1) {
          id = 0;
        } else {
          id = -1;
          return "#00000000";
        }

        return colors[id];

      }


      function style(feature) {

        return {
          fillColor: setColor(feature.properties.Cases),
          fillOpacity: 0.4,
          weight: 1,
          opacity: 1,
          color: '#b4b4b4',
          dashArray: '3'
        };

      }



      function highlightFeature(e) {
        // e indicates the current event
        var layer = e.target; //the target capture the object which the event associates with
        layer.setStyle({
          weight: 4,
          opacity: 0.8,
          color: '#e3e3e3',
          fillColor: '#00ffd9',
          fillOpacity: 0.1
        });
        // bring the layer to the front.
        layer.bringToFront();
      }

      // 3.2.2 zoom to the highlighted feature when the mouse is clicking onto it.
      function zoomToFeature(e) {
        // mymap.fitBounds(e.target.getBounds());
        L.DomEvent.stopPropagation(e);
        $("#hint").text("Click here to for State trend.");


        var t = ["t"];
        var cases = ["Cases"];
        var changeCases = ["Change in Cases"];
        var deaths = ["Deaths"];
        var changeDeaths = ["Change in Deaths"];
        var place = {
          name: e.target.feature.properties.NAME,
          c: cases,
          cc: changeCases,
          d: deaths,
          cd: changeDeaths
        }

        countyCounts(place);


        chart.load({
          columns: [place.c, place.d],
          unload: ["Cases", "Deaths"],
        });


      }

      // 3.2.3 reset the hightlighted feature when the mouse is out of its region.
      function resetHighlight(e) {
        county.resetStyle(e.target);

      }

      // 3.3 add these event the layer obejct.
      function onEachFeature(feature, layer) {
        layer.on({
          mouseover: highlightFeature,
          click: zoomToFeature,
          mouseout: resetHighlight
        });
      }



      var county = new L.GeoJSON(datasets[1], {
        style: style,
        onEachFeature: onEachFeature
      }).addTo(mymap);


      new L.control.layers(baseLayers, {
        // "Infection Level": areas,
        // "Infection Case(s) &nbsp;&nbsp; <i class='fas fa-users community'></i>": cases,
        // "Infected Community &nbsp;&nbsp; <i class='fas fa-procedures community'></i>": communities
      }, {
        collapsed: false
      }).addTo(mymap);



      $("#hint").on("click", function() {
        countyCounts(oregon);
        chart.load({
          columns: [oregon.c, oregon.d],
          unload: ['Cases', 'Deaths'],
        });

        $("#hint").text("Click on map to review county trend.");

      });


      function onMapClick(e) {
        $("#hint").click();
      }

      mymap.on('click', onMapClick);

      countyCounts(oregon);

      chart = c3.generate({
        size: {
          height: 280,
          width: 440
        },
        data: {
          x: "t",
          y: "Cases",
          columns: [t, oregon.c, oregon.d],
          type: 'spline',
          axes: {
            cases: 'y'
          },
          colors: {
            Cases: '#dc3545',
            Deaths: '#5d4f72e8'
          }
        },
        // zoom: {
        //   enabled: true,
        //   type: 'drag',
        // },
        axis: {
          x: {
            type: "timeseries",
            tick: {
              format: "%b %d",
              centered: true,
              fit: true,
              count: 8
            }
          },
          y: {
            label: {
              text: 'Cases',
              position: 'outer-middle'
            },
            min: 0,
            padding: {
              bottom: 0
            },
            type: 'linear'
          }
        },
        point: {
          r: 3.5,
          focus: {
            expand: {
              r: 5
            }
          }
        },
        zoom: {
          // rescale: true,
          enabled: false,
          type: "scroll",
        },
        tooltip: {
          linked: true,
        },
        legend: {
          position: 'inset',
          inset: {
            anchor: "top-left",
            y: 10
          },
        },
        bindto: "#total-chart"
      });




      // x = Object.keys(stop).slice(0, 9);
      // x.reverse();
      // x.push("x");
      // x.reverse();
      //
      // y = Object.values(stop).slice(0, 9);
      // y.reverse();
      // y.push("Confirmed Cases");
      // y.reverse();

      // Current Age Group Bar Chart

      var group = ["Age Group"];
      var cases = ["Cases"];


      datasets[4].forEach(function(d) {
        group.push(+d["Age Group"])
        cases.push(+d["Cases"])
      });

      agechart = c3.generate({
        size: {
          height: 280,
          width: 440
        },
        data: {
          columns: [cases],
          type: 'bar',
          labels: true,
        },
        // zoom: {
        //   enabled: true,
        //   type: 'drag',
        // },
        axis: {
          x: {
            label: {
              text: 'Age Group',
              position: 'outer-middle'
            },
            type: "category",
            categories: ['55 +', '35 to 54', '25 to 34', '18 to 24', '0-17']
          },
          y: {
            label: {
              text: 'Cases',
              position: 'outer-middle'
            },
          },
          rotated: true
        },
        tooltip: {
          linked: true,
        },
        legend: {
          hide: true,
        },
        bindto: "#age-chart"
      });

      // Aggregate Proportion of Hospitilizations Pie Chart

      var yes = ["Yes"];
      var no = ["No"];
      var np = ["Not Provided"];

      datasets[3].forEach(function(d) {
        yes.push(+d["Yes"])
        no.push(+d["No"])
        np.push(+d["Not Provided"])
      });

      hospchart = c3.generate({
        data: {
          columns: [yes, no, np],
          type: 'pie',
          labels: true,
        },
        color: {
          pattern: ['#c23829', '#c28729', 'grey']
        },
        tooltip: {
          format: {
            value: function(value, ratio, id, index) {
              return value + " Cases";
            }
          }
        },
        bindto: "#hosp-chart"
      });
    });

    /////////////////////////




    $(".leaflet-control-attribution")
      .css("background-color", "transparent")
      .html("");
  </script>
</body>

</html>
